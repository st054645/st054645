{"version":3,"file":"216.b28cde56c25afa6a29f8.chunk.js","mappings":"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","sources":["webpack://tweb/./src/helpers/array/forEachReverse.ts","webpack://tweb/./src/helpers/getFileNameForUpload.ts","webpack://tweb/./src/lib/appManagers/utils/docs/getDocumentDownloadOptions.ts","webpack://tweb/./src/lib/appManagers/utils/docs/getDocumentInput.ts","webpack://tweb/./src/lib/appManagers/utils/download/getDownloadFileNameFromOptions.ts","webpack://tweb/./src/lib/appManagers/utils/download/getDownloadMediaDetails.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/generateMessageId.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/getServerMessageId.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/clearMessageId.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/index.ts","webpack://tweb/./src/lib/appManagers/utils/photos/getPhotoDownloadOptions.ts","webpack://tweb/./src/lib/richTextProcessor/encodeSpoiler.ts","webpack://tweb/./src/lib/richTextProcessor/spoiler.ts","webpack://tweb/./src/config/tld.ts","webpack://tweb/./src/lib/richTextProcessor/checkBrackets.ts","webpack://tweb/./src/lib/richTextProcessor/getEmojiUnified.ts","webpack://tweb/./src/lib/richTextProcessor/parseEntities.ts"],"sourcesContent":["export default function forEachReverse<T>(array: Array<T>, callback: (value: T, index?: number, array?: Array<T>) => void) {\r\n  for(let length = array.length, i = length - 1; i >= 0; --i) {\r\n    callback(array[i], i, array);\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport tabId from \"../config/tabId\";\r\n\r\nlet uploadId = 0;\r\nexport default function getFileNameForUpload(file: File | Blob) {\r\n  let fileName: string;\r\n  const mimeType = file?.type;\r\n  if(mimeType) { // the same like apiFileName in appMessagesManager for upload!\r\n    const ext = `${tabId}_${uploadId++}.mimeType.split('/')[1]`;\r\n\r\n    if(['image/jpeg', 'image/png', 'image/bmp'].indexOf(mimeType) >= 0) {\r\n      fileName = 'photo' + ext;\r\n    } else if(mimeType.indexOf('audio/') === 0 || ['video/ogg'].indexOf(mimeType) >= 0) {\r\n      fileName = 'audio' + ext;\r\n    } else if(mimeType.indexOf('video/') === 0) {\r\n      fileName = 'video' + ext;\r\n    } else {\r\n      fileName = 'document' + ext;\r\n    }\r\n  } else {\r\n    fileName = `upload-${tabId}_${uploadId++}`;\r\n  }\r\n\r\n  return fileName;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type { Document, PhotoSize } from \"../../../../layer\";\r\nimport type { DownloadOptions } from \"../../../mtproto/apiFileManager\";\r\nimport getDocumentInput from \"./getDocumentInput\";\r\n\r\nexport default function getDocumentDownloadOptions(doc: Document.document, thumb?: PhotoSize.photoSize, queueId?: number, onlyCache?: boolean): DownloadOptions {\r\n  const inputFileLocation = getDocumentInput(doc, thumb?.type);\r\n\r\n  let mimeType: string;\r\n  if(thumb) {\r\n    mimeType = doc.sticker ? 'image/webp' : 'image/jpeg'/* doc.mime_type */;\r\n  } else {\r\n    mimeType = doc.mime_type || 'application/octet-stream';\r\n  }\r\n\r\n  return {\r\n    dcId: doc.dc_id, \r\n    location: inputFileLocation, \r\n    size: thumb ? thumb.size : doc.size, \r\n    mimeType,\r\n    fileName: doc.file_name,\r\n    queueId,\r\n    onlyCache\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { Document, InputFileLocation } from \"../../../../layer\";\r\n\r\nexport default function getInput(doc: Document.document, thumbSize?: string): InputFileLocation.inputDocumentFileLocation {\r\n  return {\r\n    _: 'inputDocumentFileLocation',\r\n    id: doc.id,\r\n    access_hash: doc.access_hash,\r\n    file_reference: doc.file_reference,\r\n    thumb_size: thumbSize\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { getFileNameByLocation } from \"../../../../helpers/fileName\";\r\nimport { DownloadOptions } from \"../../../mtproto/apiFileManager\";\r\n\r\nexport default function getDownloadFileNameFromOptions(options: DownloadOptions) {\r\n  return getFileNameByLocation(options.location, {fileName: options.fileName});\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type { DownloadMediaOptions } from \"../../../mtproto/apiFileManager\";\r\nimport getDocumentDownloadOptions from \"../docs/getDocumentDownloadOptions\";\r\nimport getPhotoDownloadOptions from \"../photos/getPhotoDownloadOptions\";\r\nimport getDownloadFileNameFromOptions from \"./getDownloadFileNameFromOptions\";\r\n\r\nexport default function getDownloadMediaDetails(options: DownloadMediaOptions) {\r\n  const {media, thumb, queueId, onlyCache} = options;\r\n  const downloadOptions = media._ === 'document' ? getDocumentDownloadOptions(media, thumb as any, queueId, onlyCache) : getPhotoDownloadOptions(media as any, thumb, queueId, onlyCache);\r\n  const fileName = getDownloadFileNameFromOptions(downloadOptions);\r\n  return {fileName, downloadOptions};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { MESSAGE_ID_OFFSET, MESSAGE_ID_INCREMENT } from \".\";\r\n\r\nexport default function generateMessageId(messageId: number) {\r\n  const q = MESSAGE_ID_OFFSET;\r\n  if(messageId >= q) {\r\n    return messageId;\r\n  }\r\n\r\n  return q + (messageId * MESSAGE_ID_INCREMENT);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport clearMessageId from \"./clearMessageId\";\r\n\r\n/**\r\n * * will ignore outgoing offset\r\n */\r\nexport default function getServerMessageId(messageId: number) {\r\n  return clearMessageId(messageId, true);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { MESSAGE_ID_OFFSET, MESSAGE_ID_INCREMENT } from \".\";\r\n\r\nexport default function clearMessageId(messageId: number, toServer?: boolean) {\r\n  const q = MESSAGE_ID_OFFSET;\r\n  if(messageId < q) { // id 0 -> mid 0xFFFFFFFF, so 0xFFFFFFFF must convert to 0\r\n    return messageId;\r\n  }\r\n\r\n  const l = MESSAGE_ID_INCREMENT - 1;\r\n  const used = messageId & l;\r\n  if(used !== l) {\r\n    messageId -= used + 1;\r\n  }\r\n\r\n  return toServer ? (messageId - q) / MESSAGE_ID_INCREMENT : messageId;\r\n}\r\n","export const MESSAGE_ID_INCREMENT = 0x10000;\r\nexport const MESSAGE_ID_OFFSET = 0xFFFFFFFF;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type { PhotoSize, InputFileLocation } from \"../../../../layer\";\r\nimport type { DownloadOptions } from \"../../../mtproto/apiFileManager\";\r\nimport type { MyDocument } from \"../../appDocsManager\";\r\nimport type { MyPhoto } from \"../../appPhotosManager\";\r\n\r\nexport default function getPhotoDownloadOptions(photo: MyPhoto | MyDocument, photoSize: PhotoSize, queueId?: number, onlyCache?: boolean): DownloadOptions {\r\n  const isDocument = photo._ === 'document';\r\n\r\n  if(!photoSize || photoSize._ === 'photoSizeEmpty') {\r\n    //console.error('no photoSize by photo:', photo);\r\n    throw new Error('photoSizeEmpty!');\r\n  }\r\n  \r\n  // maybe it's a thumb\r\n  const isPhoto = (photoSize._ === 'photoSize' || photoSize._ === 'photoSizeProgressive') && photo.access_hash && photo.file_reference;\r\n  const location: InputFileLocation.inputPhotoFileLocation | InputFileLocation.inputDocumentFileLocation = {\r\n    _: isDocument ? 'inputDocumentFileLocation' : 'inputPhotoFileLocation',\r\n    id: photo.id,\r\n    access_hash: photo.access_hash,\r\n    file_reference: photo.file_reference,\r\n    thumb_size: photoSize.type\r\n  };\r\n\r\n  return {\r\n    dcId: photo.dc_id, \r\n    location, \r\n    size: isPhoto ? (photoSize as PhotoSize.photoSize).size : undefined, \r\n    queueId, \r\n    onlyCache\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport { MessageEntity } from \"../../layer\";\r\nimport spoiler from \"./spoiler\";\r\n\r\nexport default function encodeSpoiler(text: string, entity: MessageEntity.messageEntitySpoiler) {\r\n  const before = text.slice(0, entity.offset);\r\n  const spoilerBefore = text.slice(entity.offset, entity.offset + entity.length);\r\n  const spoilerAfter = spoiler(spoilerBefore)/*  '▚'.repeat(entity.length) */;\r\n  const after = text.slice(entity.offset + entity.length);\r\n  text = before + spoilerAfter + after;\r\n  return {text, entityText: spoilerAfter};\r\n};\r\n","export default function spoiler(text: string): string {\r\n  const chars = '⠁⠂⠄⠈⠐⠠⡀⢀⠃⠅⠆⠉⠊⠌⠑⠒⠔⠘⠡⠢⠤⠨⠰⡁⡂⡄⡈⡐⡠⢁⢂⢄⢈⢐⢠⣀⠇⠋⠍⠎⠓⠕⠖⠙⠚⠜⠣⠥⠦⠩⠪⠬⠱⠲⠴⠸⡃⡅⡆⡉⡊⡌⡑⡒⡔⡘⡡⡢⡤⡨⡰⢃⢅⢆⢉⢊⢌⢑⢒⢔⢘⢡⢢⢤⢨⢰⣁⣂⣄⣈⣐⣠⠏⠗⠛⠝⠞⠧⠫⠭⠮⠳⠵⠶⠹⠺⠼⡇⡋⡍⡎⡓⡕⡖⡙⡚⡜⡣⡥⡦⡩⡪⡬⡱⡲⡴⡸⢇⢋⢍⢎⢓⢕⢖⢙⢚⢜⢣⢥⢦⢩⢪⢬⢱⢲⢴⢸⣃⣅⣆⣉⣊⣌⣑⣒⣔⣘⣡⣢⣤⣨⣰⠟⠯⠷⠻⠽⠾⡏⡗⡛⡝⡞⡧⡫⡭⡮⡳⡵⡶⡹⡺⡼⢏⢗⢛⢝⢞⢧⢫⢭⢮⢳⢵⢶⢹⢺⢼⣇⣋⣍⣎⣓⣕⣖⣙⣚⣜⣣⣥⣦⣩⣪⣬⣱⣲⣴⣸⠿⡟⡯⡷⡻⡽⡾⢟⢯⢷⢻⢽⢾⣏⣗⣛⣝⣞⣧⣫⣭⣮⣳⣵⣶⣹⣺⣼⡿⢿⣟⣯⣷⣻⣽⣾⣿';\r\n  const charsLength = chars.length;\r\n  \r\n  const out: string[] = [];\r\n  for(let i = 0; i < text.length; ++i) {\r\n    let char = text.charCodeAt(i);\r\n    out.push(chars[char % charsLength]);\r\n  }\r\n\r\n  return out.join('');\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n// From https://github.com/stephenmathieson/node-tlds/blob/master/index.js\r\nconst TLD = ['abogado', 'ac', 'academy', 'accountants', 'active', 'actor', 'ad', 'adult', 'ae', 'aero', 'af', 'ag', 'agency', 'ai', 'airforce', 'al', 'allfinanz', 'alsace', 'am', 'amsterdam', 'an', 'android', 'ao', 'apartments', 'aq', 'aquarelle', 'ar', 'archi', 'army', 'arpa', 'as', 'asia', 'associates', 'at', 'attorney', 'au', 'auction', 'audio', 'autos', 'aw', 'ax', 'axa', 'az', 'ba', 'band', 'bank', 'bar', 'barclaycard', 'barclays', 'bargains', 'bayern', 'bb', 'bd', 'be', 'beer', 'berlin', 'best', 'bf', 'bg', 'bh', 'bi', 'bid', 'bike', 'bingo', 'bio', 'biz', 'bj', 'black', 'blackfriday', 'bloomberg', 'blue', 'bm', 'bmw', 'bn', 'bnpparibas', 'bo', 'boo', 'boutique', 'br', 'brussels', 'bs', 'bt', 'budapest', 'build', 'builders', 'business', 'buzz', 'bv', 'bw', 'by', 'bz', 'bzh', 'ca', 'cab', 'cal', 'camera', 'camp', 'cancerresearch', 'canon', 'capetown', 'capital', 'caravan', 'cards', 'care', 'career', 'careers', 'cartier', 'casa', 'cash', 'cat', 'catering', 'cc', 'cd', 'center', 'ceo', 'cern', 'cf', 'cg', 'ch', 'channel', 'chat', 'cheap', 'christmas', 'chrome', 'church', 'ci', 'citic', 'city', 'ck', 'cl', 'claims', 'cleaning', 'click', 'clinic', 'clothing', 'club', 'cm', 'cn', 'co', 'coach', 'codes', 'coffee', 'college', 'cologne', 'com', 'community', 'company', 'computer', 'condos', 'construction', 'consulting', 'contractors', 'cooking', 'cool', 'coop', 'country', 'cr', 'credit', 'creditcard', 'cricket', 'crs', 'cruises', 'cu', 'cuisinella', 'cv', 'cw', 'cx', 'cy', 'cymru', 'cz', 'dabur', 'dad', 'dance', 'dating', 'day', 'dclk', 'de', 'deals', 'degree', 'delivery', 'democrat', 'dental', 'dentist', 'desi', 'design', 'dev', 'diamonds', 'diet', 'digital', 'direct', 'directory', 'discount', 'dj', 'dk', 'dm', 'dnp', 'do', 'docs', 'domains', 'doosan', 'durban', 'dvag', 'dz', 'eat', 'ec', 'edu', 'education', 'ee', 'eg', 'email', 'emerck', 'energy', 'engineer', 'engineering', 'enterprises', 'equipment', 'er', 'es', 'esq', 'estate', 'et', 'eu', 'eurovision', 'eus', 'events', 'everbank', 'exchange', 'expert', 'exposed', 'fail', 'farm', 'fashion', 'feedback', 'fi', 'finance', 'financial', 'firmdale', 'fish', 'fishing', 'fit', 'fitness', 'fj', 'fk', 'flights', 'florist', 'flowers', 'flsmidth', 'fly', 'fm', 'fo', 'foo', 'forsale', 'foundation', 'fr', 'frl', 'frogans', 'fund', 'furniture', 'futbol', 'ga', 'gal', 'gallery', 'garden', 'gb', 'gbiz', 'gd', 'ge', 'gent', 'gf', 'gg', 'ggee', 'gh', 'gi', 'gift', 'gifts', 'gives', 'gl', 'glass', 'gle', 'global', 'globo', 'gm', 'gmail', 'gmo', 'gmx', 'gn', 'goog', 'google', 'gop', 'gov', 'gp', 'gq', 'gr', 'graphics', 'gratis', 'green', 'gripe', 'gs', 'gt', 'gu', 'guide', 'guitars', 'guru', 'gw', 'gy', 'hamburg', 'hangout', 'haus', 'healthcare', 'help', 'here', 'hermes', 'hiphop', 'hiv', 'hk', 'hm', 'hn', 'holdings', 'holiday', 'homes', 'horse', 'host', 'hosting', 'house', 'how', 'hr', 'ht', 'hu', 'ibm', 'id', 'ie', 'ifm', 'il', 'im', 'immo', 'immobilien', 'in', 'industries', 'info', 'ing', 'ink', 'institute', 'insure', 'int', 'international', 'investments', 'io', 'iq', 'ir', 'irish', 'is', 'it', 'iwc', 'jcb', 'je', 'jetzt', 'jm', 'jo', 'jobs', 'joburg', 'jp', 'juegos', 'kaufen', 'kddi', 'ke', 'kg', 'kh', 'ki', 'kim', 'kitchen', 'kiwi', 'km', 'kn', 'koeln', 'kp', 'kr', 'krd', 'kred', 'kw', 'ky', 'kyoto', 'kz', 'la', 'lacaixa', 'land', 'lat', 'latrobe', 'lawyer', 'lb', 'lc', 'lds', 'lease', 'legal', 'lgbt', 'li', 'lidl', 'life', 'lighting', 'limited', 'limo', 'link', 'lk', 'loans', 'london', 'lotte', 'lotto', 'lr', 'ls', 'lt', 'ltda', 'lu', 'luxe', 'luxury', 'lv', 'ly', 'ma', 'madrid', 'maison', 'management', 'mango', 'market', 'marketing', 'marriott', 'mc', 'md', 'me', 'media', 'meet', 'melbourne', 'meme', 'memorial', 'menu', 'mg', 'mh', 'miami', 'mil', 'mini', 'mk', 'ml', 'mm', 'mn', 'mo', 'mobi', 'moda', 'moe', 'monash', 'money', 'mormon', 'mortgage', 'moscow', 'motorcycles', 'mov', 'mp', 'mq', 'mr', 'ms', 'mt', 'mu', 'museum', 'mv', 'mw', 'mx', 'my', 'mz', 'na', 'nagoya', 'name', 'navy', 'nc', 'ne', 'net', 'network', 'neustar', 'new', 'nexus', 'nf', 'ng', 'ngo', 'nhk', 'ni', 'nico', 'ninja', 'nl', 'no', 'np', 'nr', 'nra', 'nrw', 'ntt', 'nu', 'nyc', 'nz', 'okinawa', 'om', 'one', 'ong', 'onl', 'ooo', 'org', 'organic', 'osaka', 'otsuka', 'ovh', 'pa', 'paris', 'partners', 'parts', 'party', 'pe', 'pf', 'pg', 'ph', 'pharmacy', 'photo', 'photography', 'photos', 'physio', 'pics', 'pictures', 'pink', 'pizza', 'pk', 'pl', 'place', 'plumbing', 'pm', 'pn', 'pohl', 'poker', 'porn', 'post', 'pr', 'praxi', 'press', 'pro', 'prod', 'productions', 'prof', 'properties', 'property', 'ps', 'pt', 'pub', 'pw', 'py', 'qa', 'qpon', 'quebec', 're', 'realtor', 'recipes', 'red', 'rehab', 'reise', 'reisen', 'reit', 'ren', 'rentals', 'repair', 'report', 'republican', 'rest', 'restaurant', 'reviews', 'rich', 'rio', 'rip', 'ro', 'rocks', 'rodeo', 'rs', 'rsvp', 'ru', 'ruhr', 'rw', 'ryukyu', 'sa', 'saarland', 'sale', 'samsung', 'sarl', 'saxo', 'sb', 'sc', 'sca', 'scb', 'schmidt', 'schule', 'schwarz', 'science', 'scot', 'sd', 'se', 'services', 'sew', 'sexy', 'sg', 'sh', 'shiksha', 'shoes', 'shriram', 'si', 'singles', 'sj', 'sk', 'sky', 'sl', 'sm', 'sn', 'so', 'social', 'software', 'sohu', 'solar', 'solutions', 'soy', 'space', 'spiegel', 'sr', 'st', 'style', 'su', 'supplies', 'supply', 'support', 'surf', 'surgery', 'suzuki', 'sv', 'sx', 'sy', 'sydney', 'systems', 'sz', 'taipei', 'tatar', 'tattoo', 'tax', 'tc', 'td', 'technology', 'tel', 'temasek', 'tennis', 'tf', 'tg', 'th', 'tienda', 'tips', 'tires', 'tirol', 'tj', 'tk', 'tl', 'tm', 'tn', 'to', 'today', 'tokyo', 'tools', 'top', 'toshiba', 'town', 'toys', 'tp', 'tr', 'trade', 'training', 'travel', 'trust', 'tt', 'tui', 'tv', 'tw', 'tz', 'ua', 'ug', 'uk', 'university', 'uno', 'uol', 'us', 'uy', 'uz', 'va', 'vacations', 'vc', 've', 'vegas', 'ventures', 'versicherung', 'vet', 'vg', 'vi', 'viajes', 'video', 'villas', 'vision', 'vlaanderen', 'vn', 'vodka', 'vote', 'voting', 'voto', 'voyage', 'vu', 'wales', 'wang', 'watch', 'webcam', 'website', 'wed', 'wedding', 'wf', 'whoswho', 'wien', 'wiki', 'williamhill', 'wme', 'work', 'works', 'world', 'ws', 'wtc', 'wtf', '佛山', '集团', '在线', '한국', 'ভারত', '八卦', 'موقع', '公益', '公司', '移动', '我爱你', 'москва', 'қаз', 'онлайн', 'сайт', 'срб', '淡马锡', 'орг', '삼성', 'சிங்கப்பூர்', '商标', '商店', '商城', 'дети', 'мкд', '中文网', '中信', '中国', '中國', '谷歌', 'భారత్', 'ලංකා', 'ભારત', 'भारत', '网店', 'संगठन', '网络', 'укр', '香港', '台湾', '台灣', '手机', 'мон', 'الجزائر', 'عمان', 'ایران', 'امارات', 'بازار', 'الاردن', 'بھارت', 'المغرب', 'السعودية', 'مليسيا', 'شبكة', 'გე', '机构', '组织机构', 'ไทย', 'سورية', 'рус', 'рф', 'تونس', 'みんな', 'グーグル', '世界', 'ਭਾਰਤ', '网址', '游戏', 'vermögensberater', 'vermögensberatung', '企业', 'مصر', 'قطر', '广东', 'இலங்கை', 'இந்தியா', '新加坡', 'فلسطين', '政务', 'xxx', 'xyz', 'yachts', 'yandex', 'ye', 'yoga', 'yokohama', 'youtube', 'yt', 'za', 'zip', 'zm', 'zone', 'zuerich', 'zw'];\r\n\r\nexport default TLD;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nexport default function checkBrackets(url: string) {\r\n  var urlLength = url.length;\r\n  var urlOpenBrackets = url.split('(').length - 1;\r\n  var urlCloseBrackets = url.split(')').length - 1;\r\n  while(urlCloseBrackets > urlOpenBrackets &&\r\n    url.charAt(urlLength - 1) === ')') {\r\n    url = url.substr(0, urlLength - 1)\r\n    urlCloseBrackets--;\r\n    urlLength--;\r\n  }\r\n  if(urlOpenBrackets > urlCloseBrackets) {\r\n    url = url.replace(/\\)+$/, '');\r\n  }\r\n  return url;\r\n}\r\n","import Emoji from \"../../config/emoji\";\r\nimport { encodeEmoji } from \"../../vendor/emoji\";\r\n\r\nexport default function getEmojiUnified(emojiCode: string) {\r\n  let unified = encodeEmoji(emojiCode).replace(/-?fe0f/g, '');\r\n\r\n  /* if(unified === '1f441-200d-1f5e8') {\r\n    //unified = '1f441-fe0f-200d-1f5e8-fe0f';\r\n    unified = '1f441-fe0f-200d-1f5e8';\r\n  } */\r\n\r\n  if(!Emoji.hasOwnProperty(unified) \r\n    // && !emojiData.hasOwnProperty(unified.replace(/-?fe0f$/, ''))\r\n  ) {\r\n    //console.error('lol', unified);\r\n    return;\r\n  }\r\n\r\n  return unified;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n * \r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport { EMAIL_REG_EXP, FULL_REG_EXP } from \".\";\r\nimport TLD from \"../../config/tld\";\r\nimport { MessageEntity } from \"../../layer\";\r\nimport checkBrackets from \"./checkBrackets\";\r\nimport getEmojiUnified from \"./getEmojiUnified\";\r\n\r\nexport default function parseEntities(text: string) {\r\n  let match: any;\r\n  let raw = text;\r\n  const entities: MessageEntity[] = [];\r\n  let matchIndex;\r\n  let rawOffset = 0;\r\n  // var start = tsNow()\r\n  FULL_REG_EXP.lastIndex = 0;\r\n  while((match = raw.match(FULL_REG_EXP))) {\r\n    matchIndex = rawOffset + match.index;\r\n\r\n    //console.log('parseEntities match:', match);\r\n\r\n    if(match[3]) { // mentions\r\n      entities.push({\r\n        _: 'messageEntityMention',\r\n        offset: matchIndex + match[1].length,\r\n        length: match[2].length + match[3].length\r\n      });\r\n    } else if(match[4]) {\r\n      if(EMAIL_REG_EXP.test(match[4])) { // email\r\n        entities.push({\r\n          _: 'messageEntityEmail',\r\n          offset: matchIndex,\r\n          length: match[4].length\r\n        });\r\n      } else {\r\n        let url: string;\r\n        let protocol = match[5];\r\n        const tld = match[6];\r\n        // let excluded = '';\r\n        if(tld) { // URL\r\n          if(!protocol && (tld.substr(0, 4) === 'xn--' || TLD.indexOf(tld.toLowerCase()) !== -1)) {\r\n            protocol = 'http://';\r\n          }\r\n\r\n          if(protocol) {\r\n            const balanced = checkBrackets(match[4]);\r\n            if(balanced.length !== match[4].length) {\r\n              // excluded = match[4].substring(balanced.length);\r\n              match[4] = balanced;\r\n            }\r\n\r\n            url = (match[5] ? '' : protocol) + match[4];\r\n          }\r\n        } else { // IP address\r\n          url = (match[5] ? '' : 'http://') + match[4];\r\n        }\r\n\r\n        if(url) {\r\n          entities.push({\r\n            _: 'messageEntityUrl',\r\n            offset: matchIndex,\r\n            length: match[4].length\r\n          });\r\n        }\r\n      }\r\n    } else if(match[7]) { // New line\r\n      entities.push({\r\n        _: 'messageEntityLinebreak',\r\n        offset: matchIndex,\r\n        length: 1\r\n      });\r\n    } else if(match[8]) { // Emoji\r\n      //console.log('hit', match[8]);\r\n      const unified = getEmojiUnified(match[8]);\r\n      if(unified) {\r\n        entities.push({\r\n          _: 'messageEntityEmoji',\r\n          offset: matchIndex,\r\n          length: match[8].length,\r\n          unicode: unified\r\n        });\r\n      }\r\n    } else if(match[11]) { // Hashtag\r\n      entities.push({\r\n        _: 'messageEntityHashtag',\r\n        offset: matchIndex + (match[10] ? match[10].length : 0),\r\n        length: match[11].length\r\n      });\r\n    } else if(match[13]) { // Bot command\r\n      entities.push({\r\n        _: 'messageEntityBotCommand',\r\n        offset: matchIndex + (match[11] ? match[11].length : 0) + (match[12] ? match[12].length : 0),\r\n        length: 1 + match[13].length + (match[14] ? 1 + match[14].length : 0),\r\n        unsafe: true\r\n      });\r\n    }\r\n\r\n    raw = raw.substr(match.index + match[0].length);\r\n    rawOffset += match.index + match[0].length;\r\n  }\r\n\r\n  // if (entities.length) {\r\n  //   console.log('parse entities', text, entities.slice())\r\n  // }\r\n  return entities;\r\n}\r\n"],"names":["forEachReverse","array","callback","i","length","uploadId","getFileNameForUpload","file","fileName","mimeType","type","ext","indexOf","getDocumentDownloadOptions","doc","thumb","queueId","onlyCache","inputFileLocation","sticker","mime_type","dcId","dc_id","location","size","file_name","getInput","thumbSize","_","id","access_hash","file_reference","thumb_size","getDownloadFileNameFromOptions","options","getDownloadMediaDetails","media","downloadOptions","generateMessageId","messageId","q","getServerMessageId","toServer","l","used","clearMessageId","MESSAGE_ID_INCREMENT","MESSAGE_ID_OFFSET","getPhotoDownloadOptions","photo","photoSize","isDocument","Error","isPhoto","undefined","encodeSpoiler","text","entity","before","slice","offset","spoilerAfter","chars","charsLength","out","char","charCodeAt","push","join","spoiler","after","entityText","checkBrackets","url","urlLength","urlOpenBrackets","split","urlCloseBrackets","charAt","substr","replace","getEmojiUnified","emojiCode","unified","parseEntities","match","raw","entities","matchIndex","rawOffset","index","E","protocol","tld","toLowerCase","balanced","unicode","unsafe"],"sourceRoot":""}